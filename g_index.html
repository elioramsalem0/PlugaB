<!DOCTYPE html>
<html dir="rtl" lang="he">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>מערכת ניהול משימות</title>
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="g_styles.css">
    
    <!-- Firebase SDK - חשוב לשמור על הסדר הזה -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-analytics.js"></script>
    
    <!-- ספריית xlsx לייצוא לאקסל -->
    <script src="https://cdn.sheetjs.com/xlsx-0.19.3/package/dist/xlsx.full.min.js"></script>
    
    <!-- קובץ הסקריפט הראשי - חייב להיות אחרון -->
    <script src="g_script.js" defer></script>
</head>
<body>
    <!-- תוכן הדף -->
    <div id="loadingIndicator" class="loading-overlay hidden">
        <div class="loading-spinner"></div>
        <div class="loading-text">טוען נתונים...</div>
    </div>

    <div id="loginScreen" class="login-screen hidden">
        <form id="loginForm" class="login-form">
            <h2>התחברות למערכת</h2>
            <div class="form-group">
                <input type="text" id="username" placeholder="שם משתמש" required>
            </div>
            <div class="form-group">
                <input type="password" id="password" placeholder="סיסמה" required>
            </div>
            <div id="loginError" class="error-message hidden"></div>
            <button type="submit" class="button button-primary">התחבר</button>
        </form>
    </div>

    <div class="app-container">
        <header class="app-header">
            <div class="header-controls">
                <button id="toggleRole" class="button">
                    מצב: <span id="roleText">צופה</span>
                </button>
                <button id="toggleReport" class="button">דוח</button>
                <button id="toggleWeeklySummary" class="button">סיכום שבועי</button>
                <button id="toggleSemiAnnualReport" class="button">דוח חצי שנתי</button>
            </div>
            <div class="week-controls">
                <button id="prevWeek" class="button">שבוע קודם</button>
                <button id="currentWeek" class="button">שבוע נוכחי</button>
                <button id="nextWeek" class="button">שבוע הבא</button>
                <span id="dateRange" class="date-range"></span>
            </div>
        </header>

        <main>
            <div id="schedulerView">
                <div class="soldiers-panel">
                    <div class="soldiers-header">
                        <input type="text" id="searchInput" placeholder="חיפוש חיילים...">
                        <div id="addSoldierForm" class="add-soldier-form">
                            <input type="text" id="newFirstName" placeholder="שם פרטי">
                            <input type="text" id="newLastName" placeholder="שם משפחה">
                            <select id="newRole">
                                <option value="doctor">רופא</option>
                                <option value="paramedic">פראמדיק</option>
                                <option value="mentor">חונך</option>
                                <option value="trainee">חניך</option>
                            </select>
                            <button id="addSoldierBtn" class="button button-green">הוסף חייל</button>
                        </div>
                    </div>
                    <div id="soldiersList" class="soldiers-list"></div>
                    <div id="resizeHandle" class="resize-handle"></div>
                </div>

                <div class="calendar-container">
                    <table id="calendar">
                        <thead>
                            <tr id="daysHeaderRow">
                                <th class="task-header">משימות</th>
                            </tr>
                        </thead>
                        <tbody id="calendarBody"></tbody>
                    </table>
                </div>
            </div>

            <div id="reportView" class="report-view hidden">
                <div class="report-header">
                    <h2>דוח משימות</h2>
                    <button id="exportExcel" class="button">ייצא לאקסל</button>
                    <button id="backToCalendarBtn" class="button">חזור ללוח</button>
                </div>
                <div id="reportContent"></div>
            </div>

            <div id="weeklySummaryView" class="report-view hidden">
                <div class="report-header">
                    <h2>סיכום שבועי</h2>
                    <button id="exportWeeklySummaryExcel" class="button">ייצא לאקסל</button>
                    <button id="backToCalendarFromWeeklyBtn" class="button">חזור ללוח</button>
                </div>
                <div id="weeklySummaryContent"></div>
            </div>

            <div id="semiAnnualReportView" class="report-view hidden">
                <div class="report-header">
                    <h2>דוח חצי שנתי</h2>
                    <button id="exportSemiAnnualExcel" class="button">ייצא לאקסל</button>
                    <button id="backToCalendarFromSemiBtn" class="button">חזור ללוח</button>
                </div>
                <div id="semiAnnualContent"></div>
            </div>
        </main>
    </div>

    <!-- דיאלוגים -->
    <div id="quickAddDialog" class="dialog hidden">
        <div class="dialog-content">
            <h3>הוספה מהירה</h3>
            <p>משימה: <span id="quickAddTaskName"></span></p>
            <p>תאריך: <span id="quickAddDate"></span></p>
            <div id="availableSoldiers" class="available-soldiers"></div>
            <div class="dialog-buttons">
                <button id="quickAddConfirm" class="button button-primary">הוסף</button>
                <button id="quickAddCancel" class="button">ביטול</button>
            </div>
            <button id="closeQuickAdd" class="close-button">&times;</button>
        </div>
    </div>

    <div id="assignmentTypeDialog" class="dialog hidden">
        <div class="dialog-content">
            <h3>בחר סוג שיבוץ</h3>
            <div class="dialog-buttons">
                <button id="assignSingleDay" class="button button-primary">שיבוץ ליום בודד</button>
                <button id="assignFullWeek" class="button button-primary">שיבוץ לכל השבוע</button>
            </div>
            <button id="closeAssignmentTypeDialog" class="close-button">&times;</button>
        </div>
    </div>

    <div id="addTaskDialog" class="dialog hidden">
        <div class="dialog-content">
            <h3>הוספת משימה חדשה</h3>
            <input type="text" id="newTaskName" placeholder="שם המשימה">
            <div class="dialog-buttons">
                <button id="addTaskConfirm" class="button button-primary">הוסף</button>
                <button id="addTaskCancel" class="button">ביטול</button>
            </div>
            <button id="closeAddTaskDialog" class="close-button">&times;</button>
        </div>
    </div>
</body>
</html>